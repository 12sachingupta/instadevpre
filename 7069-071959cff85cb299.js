!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="8ee66471-81f5-4d74-98b2-406af39d0373",e._sentryDebugIdIdentifier="sentry-dbid-8ee66471-81f5-4d74-98b2-406af39d0373")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7069],{95107:function(e,t,a){a.d(t,{m:function(){return i}});var l=a(27573),s=a(57908);a(7653);let i=e=>{let{title:t,description:a,className:i}=e;return(0,l.jsxs)("div",{className:(0,s.Z)("flex flex-auto flex-col items-center justify-center px-4 text-center",i),children:[(0,l.jsx)("h1",{className:"mb-6 text-xl font-extrabold text-[#6096FF] sm:text-2xl",children:t}),(0,l.jsx)("h2",{className:"text-md mt-2 text-neutral-600 sm:mt-0 dark:text-white",children:a})]})}},83059:function(e,t,a){a.d(t,{z:function(){return i}});var l=a(7653),s=a(23269);let i=()=>{let{data:e}=(0,s.Pc)();return(0,l.useMemo)(()=>!!e&&e.is_superuser,[e])}},57069:function(e,t,a){a.d(t,{xq:function(){return Q},Wy:function(){return ec},I0:function(){return I.I},vn:function(){return P.vn}});var l=a(27573),s=a(57908),i=a(30449),r=a(18255),o=a.n(r),d=a(67754),n=a(7653),c=a(88254),u=a(9054),m=a(54154),p=a(95107),x=a(19771),b=a(52635),f=a(4652),y=a(53358),h=a(2174),v=a(55076),k=a(1869);let j=n.forwardRef((e,t)=>{let{children:a,...s}=e;return(0,l.jsx)(k.fC,{className:"relative flex h-full w-full flex-col",...s,ref:t,children:a})});j.displayName="TabsContent";let g=n.forwardRef((e,t)=>{let{children:a,...s}=e;return(0,l.jsx)(k.VY,{className:"h-[calc(100%_-_50px)] flex-1 flex-col overflow-y-auto [&:not([hidden])]:flex",...s,ref:t,children:a})});g.displayName="TabsContent";let _=n.forwardRef((e,t)=>{let{children:a,...s}=e;return(0,l.jsx)(k.aV,{className:"absolute right-2 top-2 z-10 flex overflow-hidden rounded-lg bg-slate-200 dark:bg-[#5a5a5a]",...s,ref:t,children:a})});_.displayName="TabsList";let w=n.forwardRef((e,t)=>{let{children:a,...s}=e;return(0,l.jsx)(k.xz,{className:"dark:data-[state=active]:bg-shade w-[66px] px-2.5 py-1.5 text-xs font-semibold data-[state=active]:bg-white data-[state=active]:text-[#3b82f6] data-[state=inactive]:text-[#666666] dark:data-[state=active]:text-white dark:data-[state=inactive]:text-[#ababab]",...s,ref:t,children:a})});w.displayName="TabsTrigger";let N=n.forwardRef((e,t)=>{let{children:a,...s}=e;return(0,l.jsx)(k.fC,{className:"relative flex h-full w-full flex-col",...s,ref:t,children:a})});N.displayName="TabsContent";let C=n.forwardRef((e,t)=>{let{children:a,...s}=e;return(0,l.jsx)(k.VY,{className:"relative h-[calc(100%_-_50px)] flex-1 flex-col overflow-y-auto [&:not([hidden])]:flex",...s,ref:t,children:a})});C.displayName="TabsContent";let F=n.forwardRef((e,t)=>{let{children:a,...s}=e;return(0,l.jsx)(k.aV,{className:"mt-2 border-b border-[#f2f2f2] dark:border-[#484848]",...s,ref:t,children:a})});F.displayName="TabsList";let S=n.forwardRef((e,t)=>{let{children:a,...s}=e;return(0,l.jsx)(k.xz,{className:"dark:data-[state=active]:bg-shade mb-[-1px] border-b-2 px-2.5 pb-3 pt-1.5 text-sm font-medium leading-none data-[state=inactive]:border-transparent data-[state=active]:bg-white data-[state=active]:text-[#000] data-[state=inactive]:text-[#666666] dark:data-[state=active]:border-white dark:data-[state=active]:text-white dark:data-[state=inactive]:text-[#ababab]",...s,ref:t,children:a})});S.displayName="TabsTrigger";var L=a(83059),D=a(48536),P=a(58919),I=a(59730),T=a(61070),z=a(35914);let M=e=>{let{children:t}=e;return(0,l.jsx)(T.U,{className:"prose prose-sm dark:prose-invert prose-p:whitespace-pre-wrap prose-pre:whitespace-pre-wrap max-w-max [overflow-wrap:anywhere]",rehypePlugins:[[z.Z,{target:"_blank"}]],children:t})};var E=a(9565),R=a(36168),A=a(28488);let B=()=>{let e=(0,P.vn)(e=>e.playbookDraft),t=(0,P.vn)(e=>e.updatePlaybookDraft),a=(0,n.useCallback)(async()=>{t({compiled:{value:void 0,status:P.j_.Compiling}}),t({compiled:{value:await (0,D.dg)(e.body),status:P.j_.SuccessCompiled}})},[e,t]),s=e.compiled.status===P.j_.Loading,i=e.compiled.status===P.j_.Compiling,r=e.compiled.status===P.j_.Idle,o=e.compiled.status===P.j_.SuccessCompiled,d=e.compiled.status===P.j_.SuccessLoaded,c=(o||d)&&e.compiled.value&&1===Object.keys(e.compiled.value).length&&e.compiled.value.error;return(0,l.jsxs)("div",{className:"flex flex-1 flex-col",children:[(0,l.jsx)("h3",{className:"mb-3.5 mt-4 px-2.5 text-sm font-semibold",children:"Compilation"}),(0,l.jsxs)("div",{className:"relative flex h-[calc(100%_-_50px)] w-full flex-col items-center justify-center overflow-y-auto rounded-lg bg-slate-100 p-4 dark:bg-[#484848] dark:text-white",children:[(r||i)&&(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center text-center",children:[(0,l.jsx)(y.z,{loading:i,onClick:a,disabled:i,className:"w-[107px]",theme:"primary",defaultTitle:i?"Compiling...":"Compile",size:"sm"}),(0,l.jsx)("p",{className:"mt-2 text-xs",children:"No compilation results yet"})]}),s&&(0,l.jsx)("div",{className:"flex flex-col items-center justify-center text-center",children:(0,l.jsx)(x.T,{size:"sm"})}),(o||d)&&(c?(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center text-center",children:[(0,l.jsx)("h3",{className:"font-semibold text-red-500",children:"Error"}),(0,l.jsx)("p",{className:"mt-2 text-xs",children:c.text})]}):(0,l.jsx)("div",{className:"peer absolute left-0 h-full w-full p-4",children:Object.keys(e.compiled.value).length>0&&(0,l.jsx)("div",{children:Object.keys(e.compiled.value).map(t=>(0,l.jsx)(O,{nodeItem:e.compiled.value[t]},t))})}))]})]})},O=e=>{let{nodeItem:t}=e,[a,i]=(0,n.useState)(!1);return(0,l.jsxs)(A.fC,{open:a,onOpenChange:i,className:"group",children:[(0,l.jsx)(A.xz,{asChild:!0,children:(0,l.jsxs)("h3",{className:(0,s.Z)("flex cursor-pointer select-none items-center border-[#eeeeee] pb-3 pt-3 text-sm font-medium group-[:last-child]:border-0 group-[:first-child]:pt-0 dark:border-[#8F8F8F]",!a&&"border-b"),children:[a?(0,l.jsx)(E.p,{size:16,className:"mr-2 mt-[2.5px] flex-shrink-0 self-start"}):(0,l.jsx)(R.U,{size:16,className:"mr-2 mt-[2.5px] flex-shrink-0 self-start"}),(0,l.jsxs)("div",{className:(0,s.Z)(!a&&"line-clamp-1 "),children:[t.id," ",t.text]})]})}),(0,l.jsxs)(A.VY,{className:"border-b border-[#eeeeee] pb-4 pl-6 dark:border-[#8F8F8F]",children:[(0,l.jsx)("h4",{className:"my-2 text-sm font-medium",children:"Details"}),(0,l.jsx)(M,{children:t.details}),(0,l.jsx)("h4",{className:"my-2 text-sm font-medium",children:"Requirements"}),(0,l.jsx)(M,{children:t.requirements}),t.out_edges.length>0&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("h4",{className:"my-2 text-sm font-medium",children:"Related procedure steps"}),(0,l.jsx)("ul",{className:"ml-6 list-disc rounded-lg bg-slate-100 text-sm marker:text-[#D1D5DB] dark:bg-[#484848] dark:text-[#D1D5DB] dark:marker:text-[#4B5563]",children:t.out_edges.map(e=>(0,l.jsxs)("li",{className:"relativep-2 mb-2 last:mb-0 last:border-0",children:[(0,l.jsxs)("div",{className:"text-sm",children:[e.id," ",e.condition]}),(0,l.jsx)("div",{className:"text-xs",children:(0,l.jsxs)("em",{children:["Confidence: ",e.confidence]})})]},e.id))})]})]})]})};var Z=a(35592),Y=a(12122);let U=e=>{let{children:t,appearance:a="default",onClick:i,size:r="small"}=e;return(0,l.jsx)("button",{className:(0,s.Z)("mr-2 flex items-center border border-[currentColor] text-xs",{"text-[#6096FF]":"primary"===a,"text-gray-600 dark:text-white":"default"===a,"rounded-md px-2 py-[5px] font-semibold":"medium"===r,"rounded-full px-2 py-1 font-bold":"small"===r}),onClick:i,children:t})},q=e=>{let{playbook:t,size:a="small"}=e,s=(0,Y.F)(e=>e.setSelectedPlaybook),i=(0,Y.F)(e=>e.selectedPlaybook),r=(null==i?void 0:i.id)===t.id,o=(0,d.useRouter)(),c=(0,n.useCallback)(()=>{r?s(null):(s(t),o.push("/?playbook=".concat(t.id)))},[s,r,t,o]);return(0,l.jsx)(U,{onClick:c,appearance:r?"primary":"default",size:a,children:r?(0,l.jsxs)(l.Fragment,{children:["Selected",(0,l.jsx)(Z.J,{size:"small"===a?12:16,className:"ml-2"})]}):(0,l.jsx)(l.Fragment,{children:"Select"})})};var V=a(87659);let G=e=>{let{sessionsList:t,isLoading:a=!1}=e;return a?(0,l.jsx)("div",{className:"flex h-full w-full items-center justify-center text-sm text-[#8F8F8F] dark:text-[#8F8F8F]",children:"Loading..."}):t&&0!==t.length?(0,l.jsxs)("table",{className:"absolute mt-2 w-full",children:[(0,l.jsx)("thead",{className:"dark:bg-shade sticky top-0",children:(0,l.jsxs)("tr",{className:"text-left text-xs dark:text-[#8F8F8F]",children:[(0,l.jsx)("th",{className:"py-3",children:"Session name"}),(0,l.jsx)("th",{className:"py-3",children:"Date used"}),(0,l.jsx)("th",{className:"py-3",children:"Created by"}),(0,l.jsx)("th",{className:"py-3"})]})}),(0,l.jsx)("tbody",{children:t.map(e=>(0,l.jsx)(W,{sessionItem:e},e.devin_id))})]}):(0,l.jsx)("div",{className:"flex h-full w-full items-center justify-center text-sm text-[#8F8F8F] dark:text-[#8F8F8F]",children:"No sessions found"})},W=e=>{let{sessionItem:t}=e,a=(0,h.lp)(t.created_at);return(0,l.jsxs)("tr",{className:"text-xs",children:[(0,l.jsx)("td",{className:"py-3 font-semibold dark:text-white",children:t.title||"Untitled"}),(0,l.jsx)("td",{className:"py-3 text-[#8F8F8F]",children:a}),(0,l.jsx)("td",{className:"py-3 text-[#8F8F8F]",children:t.created_by.full_name}),(0,l.jsx)("td",{className:"py-3 font-semibold dark:text-white",children:(0,l.jsx)(V.default,{href:"/sessions/".concat((0,v.I0)(t.devin_id)),className:"underline",children:"View session"})})]},t.devin_id)},K={upsertButton:{create:"Create",edit:"Save"},upsertSuccess:{create:"Playbook created successfully",edit:"Playbook updated successfully"},upsertFailure:{create:"Failed to create playbook",edit:"Failed to update playbook"}},Q=e=>{let{id:t,action:a}=e,{isLoaded:r,orgId:k}=(0,f.aC)(),{user:T}=(0,f.aF)(),z=(0,d.useRouter)(),E=(0,d.useSearchParams)().get("from"),R=(0,L.z)(),A=(0,P.vn)(e=>e.createPlaybook),O=(0,P.vn)(e=>e.getPlaybookById),Z=(0,P.vn)(e=>e.updatePlaybookById),Y=(0,P.vn)(e=>e.deletePlaybookById),U=(0,P.vn)(e=>e.playbookDraft),V=(0,P.vn)(e=>e.updatePlaybookDraft),W=(0,P.vn)(e=>e.resetPlaybookDraft),Q=(0,n.useMemo)(()=>U.examples.map(e=>({id:e.devin_id,text:(0,v.I0)(e.devin_id)})),[U.examples]),X=(0,n.useCallback)(e=>{V({examples:e.map(e=>({playbook_id:U.id,devin_id:e.id,title:e.text,created_at:new Date().toISOString(),created_by:{id:(null==T?void 0:T.user_id)||"you",full_name:(null==T?void 0:T.name)||"You",image_url:null==T?void 0:T.picture}}))})},[V,U.id,null==T?void 0:T.user_id,null==T?void 0:T.name,null==T?void 0:T.picture]),[H,J]=(0,u.Z)(async()=>{switch(a){case"create":{let e="file"===E;""===U.id||e||W(),V({...e?o().omit(P.Dg,["title","body"]):P.Dg,org_id:k||"your-org-id",created_by:{id:(null==T?void 0:T.user_id)||"you",full_name:(null==T?void 0:T.name)||"You"},updated_by:{id:(null==T?void 0:T.user_id)||"you",full_name:(null==T?void 0:T.name)||"You"}})}break;case"edit":{let e=O(t),a=!!e,l=e||await (0,D.Y8)(t);l.compiled||(l.compiled={status:P.j_.Idle,value:void 0}),a||A(l),U.id!==l.id&&W(),V(l)}}},[a,k,null==T?void 0:T.name,V,E],{loading:!0,error:void 0,value:void 0});(0,n.useEffect)(()=>{r&&J()},[r,J]);let $=(0,n.useCallback)(async()=>{if(!U.compilation_presigned_url)return;V({compiled:{status:P.j_.Loading,value:void 0}});let e=await (0,D.By)({url:U.compilation_presigned_url,headers:U.compilation_presigned_headers}),t={...U,compiled:{status:P.j_.SuccessLoaded,value:e}};V({compiled:t.compiled}),Z(U.id,t)},[V,U,Z]);(0,n.useEffect)(()=>{r&&U.compiled.status===P.j_.Idle&&$()},[r,U.compiled.status,$]);let[ee,et]=(0,u.Z)(async()=>{try{if(!window.confirm("Do you really want to delete the playbook?"))return;b.Z.trackInteraction(b.j.DELETE_PLAYBOOK),await (0,D.eF)(U.id),Y(U.id),z.push("/playbooks",{}),m.A.success("Playbook deleted successfully")}catch(e){throw m.A.error("Failed to delete playbook"),console.error(e),e}},[U,Y,z]),[ea,el]=(0,n.useState)("create"===a?"edit":"preview"),[es,ei]=(0,n.useState)("details"),[er,eo]=(0,n.useState)(ea),ed=(0,n.useCallback)(e=>{eo(e)},[eo]),en=(0,n.useCallback)(e=>{ei(e)},[ei]),ec=(0,n.useCallback)(()=>{switch(a){case"create":W();break;case"edit":V(O(U.id)),el("preview"),eo("preview")}},[a,U,W,V,O,el]),[eu,em]=(0,u.Z)(async()=>{try{let e={...o().pick(U,["title","body","status","access"]),examples:U.examples.map(e=>e.devin_id)};switch(U.compiled.status===P.j_.SuccessCompiled?(e.compiled_value=U.compiled.value,e.compiled_status=U.compiled.status):U.compiled.status===P.j_.SuccessLoaded?(e.compiled_value=void 0,e.compiled_status=U.compiled.status):U.compiled.status===P.j_.Idle&&(e.compiled_value=void 0,e.compiled_status=U.compiled.status),a){case"create":{let{id:t}=await (0,D.px)(e),a={...U,title:U.title.trim(),body:U.body.trim(),id:t,org_id:k||"your-org-id",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),created_by:{id:T.user_id||"you",full_name:T.name||"You",image_url:T.picture},updated_by:{id:T.user_id||"you",full_name:T.name||"You",image_url:T.picture}};A(a),V(a),z.push("/playbooks/".concat((0,I.I)(t)),{})}break;case"edit":{await (0,D.df)(U.id,e);let t={...U,title:U.title.trim(),body:U.body.trim(),updated_by:{id:(null==T?void 0:T.user_id)||"you",full_name:T.name||"You",image_url:T.picture},updated_at:new Date().toISOString()};t.compiled.status===P.j_.SuccessCompiled&&(t.compiled.status=P.j_.SuccessLoaded),Z(U.id,t),V(t)}}m.A.success(K.upsertSuccess[a])}catch(e){throw m.A.error(K.upsertFailure[a]),console.error(e),e}},[V,A,Z,U,T,k]),ep=(0,n.useCallback)(e=>{V({title:e.target.value})},[V]),ex=(0,n.useCallback)(e=>{V({body:e.target.value,compiled:{status:P.j_.Idle,value:void 0},compilation_presigned_url:void 0})},[V]),eb=(0,n.useCallback)(e=>{V({access:e})},[V]),ef=(0,n.useMemo)(()=>{let e="edit"===a?O(U.id):P.Dg;if(!e)return!1;let t=e.examples.length!==U.examples.length;if(!t){let a=e.examples.map(e=>e.devin_id),l=U.examples.map(e=>e.devin_id);t=!o().isEqual(a,l)}return e.title!==U.title||e.body!==U.body||e.status!==U.status||e.access!==U.access||t||e.compiled.status!==U.compiled.status},[a,U,O]),ey=(0,n.useMemo)(()=>""===U.title.trim()||""===U.body.trim(),[U.title,U.body]),eh=H.loading,ev=void 0!==H.error,ek=(0,h.lp)(U.created_at),ej=(0,h.lp)(U.updated_at),eg=(0,n.useMemo)(()=>[..."create"===a?[[{label:"Author",value:U.created_by.full_name}]]:[[{label:"Created by",value:U.created_by.full_name},{label:"Created at",value:ek}],[{label:"Updated by",value:U.updated_by.full_name},{label:"Updated at",value:ej}]]],[a,U,ek,ej]),e_="community"===U.access,ew=e_&&!R,eN=(0,n.useCallback)(()=>{eo("edit"),el("edit")},[el,eo]),{data:eC=[],isLoading:eF}=(0,v.dL)(),eS=(0,n.useMemo)(()=>eC.filter(e=>e.playbook_id===U.id),[eC,U]);if(eh)return(0,l.jsx)(h.W2,{className:"relative pt-6",children:(0,l.jsx)(x.T,{size:"md"})});if(ev){let e=ev&&H.error instanceof i.B&&404===H.error.response.status;return(0,l.jsx)(h.W2,{className:"pt-6",children:(0,l.jsx)(p.m,{title:e?"404":"Error",description:e?"This page could not be found.":"An error occurred while loading the page."})})}return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(h.nK,{action:a,listHref:"/playbooks",listTitle:"Playbooks",itemTitle:"create"===a?"Create playbook":U.title||"Untitled Playbook",title:U.title,titlePlaceholder:"Untitled Playbook",onTitleChange:ep,metadata:eg,titleReadOnly:ew||"preview"===ea}),(0,l.jsxs)(N,{value:es,onValueChange:en,children:["edit"===a&&(0,l.jsxs)(F,{children:[(0,l.jsx)(S,{value:"details",children:"Details"}),(0,l.jsxs)(S,{value:"past-runs",children:["Past sessions"," ",!eF&&(0,l.jsxs)(l.Fragment,{children:["(",eS.length,")"]})]}),e_&&(0,l.jsx)(S,{value:"examples",children:"Examples"})]}),(0,l.jsx)(C,{value:"details",children:(0,l.jsxs)(l.Fragment,{children:["preview"===ea?ew?null:(0,l.jsx)("div",{className:"mt-4 flex items-center justify-end py-2",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(q,{playbook:U,size:"medium"}),(0,l.jsx)(y.z,{onClick:eN,className:"w-[98px]",defaultTitle:"Edit",theme:"primary",size:"sm"})]})}):(0,l.jsxs)("div",{className:(0,s.Z)("mt-4 flex items-center py-2",R?"justify-between":"justify-end"),children:[R&&(0,l.jsxs)("div",{className:"ml-2 flex items-start rounded-lg pl-1 outline outline-offset-4 outline-[#FF5E5E]",children:[(0,l.jsx)("div",{className:"mr-3 h-8 content-center text-sm font-bold text-[#FF5E5E]",children:"Admin"}),(0,l.jsx)("div",{children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("label",{className:"mr-2 text-xs font-bold",htmlFor:"playbook-access",children:"Access"}),(0,l.jsx)(y.P,{placeholder:"Access",itemsList:[{value:"team",label:"Team"},{value:"community",label:"Community"}],className:"w-[107px]",defaultValue:U.access,onValueChange:eb,id:"playbook-access"})]})}),"community"===U.access&&(0,l.jsxs)("div",{className:"ml-3 flex",children:[(0,l.jsx)("label",{className:"mr-2 h-8 content-center text-xs font-bold",htmlFor:"playbook-examples",children:"Examples"}),(0,l.jsx)(c.V,{inputFieldPosition:"top",autofocus:!1,tags:Q,id:"playbook-examples",handleDelete:e=>{X(Q.filter((t,a)=>a!==e))},handleAddition:e=>{let t={id:(0,v.cX)(e.id),text:e.text};Q.find(e=>e.id===t.id)||X([...Q,t])},handleDrag:(e,t,a)=>{let l=[...Q];l.splice(t,1),l.splice(a,0,e),X(l)},handleTagClick:e=>{window.open("/sessions/".concat((0,v.I0)(Q[e].id)),"_blank")},placeholder:"Sessions ids",classNames:{tag:"text-xs p-2",tagInputField:"text-ellipsis rounded-lg border border-transparent bg-slate-50 px-2 py-[7px] text-xs outline-none focus:border-slate-200 dark:bg-[#484848] dark:text-white dark:focus:border-[#383838]"}})]})]}),(0,l.jsxs)("div",{className:"flex items-center",children:["edit"===a&&(0,l.jsx)(y.z,{loading:ee.loading,onClick:et,disabled:ew||ee.loading,className:"mr-4 w-[96px]",theme:"danger",defaultTitle:"Delete",size:"sm"}),(0,l.jsx)(y.z,{onClick:ec,theme:"simple",className:"mr-4",disabled:"create"===a&&!ef,defaultTitle:"Revert changes",size:"sm"}),(0,l.jsx)(y.z,{loading:eu.loading,onClick:em,disabled:ew||ey||!ef||eu.loading,className:"w-[98px]",defaultTitle:K.upsertButton[a],theme:"primary",size:"sm"})]})]}),(0,l.jsxs)("div",{className:"flex flex-1 flex-row gap-6 overflow-hidden",children:[(0,l.jsxs)("div",{className:"flex flex-1 flex-col",children:[(0,l.jsx)("label",{className:"mb-3.5 mt-4 px-2.5 text-sm font-semibold",htmlFor:"playbook-body",children:"Content"}),(0,l.jsxs)(j,{value:er,onValueChange:ed,children:["edit"===ea&&(0,l.jsxs)(_,{children:[(0,l.jsx)(w,{value:"edit",children:"Edit"}),(0,l.jsx)(w,{value:"preview",children:"Preview"})]}),(0,l.jsx)(g,{value:"edit",children:(0,l.jsx)(h.gx,{id:"playbook-body",value:U.body,onChange:ex,placeholder:"Write your playbook here...",readOnly:ew,supportMdLists:!0})}),(0,l.jsx)(g,{value:"preview",children:(0,l.jsx)("div",{className:"scrollbar-hide absolute h-full w-full flex-1 overflow-y-auto rounded-lg bg-slate-100 p-4 dark:bg-[#484848] dark:text-white",children:(0,l.jsx)(M,{children:U.body})})})]})]}),"edit"===ea&&(0,l.jsx)(B,{})]})]})}),(0,l.jsx)(C,{value:"past-runs",children:(0,l.jsx)(G,{sessionsList:eS,isLoading:eF})}),e_&&(0,l.jsx)(C,{value:"examples",children:(0,l.jsx)(G,{sessionsList:U.examples})})]})]})};var X=a(61597),H=a(95014),J=a(4699),$=a(51744),ee=a(23130),et=a(75113),ea=a(5454),el=a(24449);let es=e=>{let{playbookId:t}=e,{userId:a}=(0,f.aC)(),i=(0,P.vn)(e=>e.setFavoritesList),r=(0,el.jk)(),o=(0,el.cZ)().data,d=(0,n.useMemo)(()=>null==o?void 0:o.includes(t),[t,o]),c=(0,n.useCallback)(async()=>{if(a)try{let e=d?(null!=o?o:[]).filter(e=>e!==t):[...null!=o?o:[],t];i(e),await r.mutateAsync({playbooks_favorites:e}),m.A.success(d?"Playbook removed from favorites":"Playbook added to favorites")}catch(e){throw m.A.error("Failed to add playbook to favorites"),console.error(e),e}},[a,d,o,t,i,r]);return(0,l.jsx)(et.u,{content:(0,l.jsx)("div",{className:"px-2 py-1.5 text-xs",children:d?"Remove from favorites":"Add to favorites"}),delayDuration:0,children:(0,l.jsx)("button",{onClick:c,children:(0,l.jsx)(ea.U,{className:(0,s.Z)({"text-[#6096FF]":d,"text-gray-600 dark:text-white":!d}),weight:d?"fill":"regular"})})})},ei=e=>{let{playbookId:t,children:a}=e;return(0,l.jsx)(V.default,{href:"/playbooks/".concat((0,I.I)(t)),className:"mr-2 rounded-full border border-[currentColor] px-2 py-1 text-xs text-gray-600 dark:text-white",children:a})},er=e=>{let{action:t}=e,{isLoaded:a,userId:s,orgId:i}=(0,f.aC)(),r=(0,P.vn)(e=>e.playbooksListState),o=(0,P.vn)(e=>e.setPlaybooksListState),d=(0,P.vn)(e=>e.favoritesList),c=(0,P.vn)(e=>e.setFavoritesList),u=(0,P.vn)(e=>e.playbooksList),m=(0,P.vn)(e=>e.setPlaybooksList),p=(0,n.useCallback)(async()=>{o(P.Gu.Loading),m((await (0,D.Cm)()).map(e=>u.find(t=>e.id===t.id)||e));let e=await (0,D.BG)();e.playbooks_favorites&&c(e.playbooks_favorites),o(P.Gu.Success)},[m,o,c,u]);(0,n.useEffect)(()=>{a&&r===P.Gu.Idle&&p()},[p,a,r]);let b=(0,n.useMemo)(()=>{let e=null==i?void 0:i.startsWith("personal-");return[{value:"favorites",title:"My favorites",list:u.filter(e=>d.includes(e.id))},{value:"mine",title:"My playbooks",list:u.filter(e=>e.created_by.id===s&&e.org_id===i)},...e?[]:[{value:"team",title:"Team playbooks",list:u.filter(e=>e.org_id===i)}],{value:"community",title:"Community playbooks",list:u.filter(e=>"community"===e.access)}]},[u,d,s,i]),[y,v]=(0,n.useState)("");return[P.Gu.Loading,P.Gu.Idle].includes(r)?(0,l.jsx)(x.T,{size:"sm"}):(0,l.jsx)(h.yq,{action:t,createLink:"/playbooks/create",createText:"Create new playbook",lists:b,searchPlaceholder:"Search playbooks",setSearchTerm:v,children:e=>(0,l.jsx)(eo,{list:e,searchTerm:y,action:t})})},eo=e=>{let{list:t,searchTerm:a,action:i}=e,r=(0,n.useMemo)(()=>new ee.Z(t,{findAllMatches:!0,keys:["title","body","created_by.full_name","updated_by.full_name"],minMatchCharLength:1,threshold:.2}),[t]),o=(0,n.useMemo)(()=>a?r.search(a).map(e=>e.item):t,[r,t,a]);(0,n.useEffect)(()=>{c(0)},[a]);let[d,c]=(0,n.useState)(0),u=(0,n.useMemo)(()=>{let e=12*d;return o.slice(e,e+12)},[o,d]),m=(0,n.useMemo)(()=>Math.ceil(o.length/12),[o]),p=(0,n.useCallback)(e=>{c(e)},[c]);return o.length?(0,l.jsxs)("div",{className:"absolute",children:[(0,l.jsx)("ul",{className:"grid h-full w-full grid-cols-1 content-start gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4",children:u.map(e=>(0,l.jsx)(en,{playbook:e,action:i},e.id))}),(0!==d||u.length>=8)&&(0,l.jsxs)("div",{className:"mt-10 flex items-center justify-center text-gray-600 dark:text-white",children:[(0,l.jsx)("button",{className:"mr-2 hover:text-gray-500 dark:hover:text-[#bbbbbb]",disabled:0===d,onClick:()=>p(d-1),children:(0,l.jsx)(X.W,{size:12})}),(0,l.jsx)("ul",{className:"flex space-x-2",children:Array.from({length:m},(e,t)=>(0,l.jsx)("li",{children:(0,l.jsx)("button",{className:(0,s.Z)("h-8 w-8 rounded text-xs",d===t?"border border-[currentColor]":"border border-transparent hover:border-gray-500 hover:text-gray-500 dark:hover:border-[#bbbbbb] dark:hover:text-[#bbbbbb]"),onClick:()=>p(t),children:t+1})},t))}),(0,l.jsx)("button",{className:"ml-2 hover:text-gray-500 dark:hover:text-[#bbbbbb]",disabled:d===m-1,onClick:()=>p(d+1),children:(0,l.jsx)(H.T,{size:12})})]})]}):(0,l.jsx)("div",{className:"text-xs text-[#8f8f8f]",children:"No playbooks found"})},ed=e=>{let t=e.match(RegExp("##+ +Overview\\s+([\\s\\S]*?)(?=\\n{2,}|$)","s"));return t?t[1]:e},en=e=>{let{playbook:t,action:a}=e,i=(0,P.vn)(e=>e.setPlaybookPreviewId),r=(0,n.useCallback)(()=>{i(t.id)},[t,i]),o=(0,P.vn)(e=>e.playbookSelected),d=(null==o?void 0:o.id)===t.id,c=(0,h.lp)(t.created_at),u=(0,n.useMemo)(()=>ed(t.body),[t.body]),m="manage"===a;return(0,l.jsxs)("li",{className:(0,s.Z)("rounded-[12px] border border-[#f2f2f2] p-4 hover:border-[#8b8b8b] dark:border-[#484848] dark:bg-[#353535] dark:hover:border-white",d&&"!border-[#6096FF] dark:!border-[#6096FF]"),children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)(V.default,{href:"/playbooks/".concat((0,I.I)(t.id)),className:"mr-2",children:(0,l.jsxs)("h3",{className:(0,s.Z)("flex items-center break-all text-sm font-bold text-gray-600 hover:underline dark:text-white",d&&"!text-[#6096FF]"),children:[(0,l.jsx)(J.M,{size:18,className:"mr-2 shrink-0 text-[#6096FF]"})," ",(0,l.jsx)("span",{className:"line-clamp-1",children:t.title})]})}),"select"===a&&(0,l.jsx)(et.u,{content:(0,l.jsx)("div",{className:"px-2 py-1.5 text-xs",children:"Preview"}),delayDuration:0,children:(0,l.jsx)("button",{className:"text-gray-600 dark:text-white",onClick:r,children:(0,l.jsx)($.S,{size:20})})})]}),(0,l.jsxs)("div",{className:"mt-1 text-xs text-[#8F8F8F]",children:[(0,l.jsx)("span",{children:t.created_by.full_name})," |"," ",(0,l.jsx)("span",{children:c})]})]}),(0,l.jsx)("p",{className:"mt-2 line-clamp-2 h-8 text-xs text-gray-600 dark:text-[#8F8F8F]",children:u}),(0,l.jsxs)("div",{className:"mt-2 flex items-center",children:[m&&(0,l.jsx)(ei,{playbookId:t.id,children:"Open"}),m&&(0,l.jsx)(q,{playbook:t,size:"small"}),(0,l.jsx)(es,{playbookId:t.id})]})]})},ec=()=>(0,l.jsx)(er,{action:"manage"})},48536:function(e,t,a){a.d(t,{BG:function(){return b},By:function(){return x},Cm:function(){return o},Y8:function(){return d},df:function(){return c},dg:function(){return p},eF:function(){return u},px:function(){return n},yX:function(){return f}});var l=a(18255),s=a.n(l),i=a(29484),r=a(58022);let o=async()=>await i.L.get("playbooks").json(),d=async e=>await i.L.get("playbooks/".concat(e)).json(),n=async e=>await i.L.post("playbooks",{json:e}).json(),c=async(e,t)=>await i.L.put("playbooks/".concat(e),{json:t}).json(),u=async e=>await i.L.delete("playbooks/".concat(e)).json(),m=async e=>await i.L.post("playbooks/compile",{json:{source_code:e}}).json(),p=s().memoize(m),x=async e=>JSON.parse((await (0,r.i2)(e,{shouldRetry:!0})).value),b=async()=>await i.L.get("user-orgs/metadata").json(),f=async e=>await i.L.put("user-orgs/metadata",{json:e}).json()},58919:function(e,t,a){a.d(t,{Dg:function(){return d},Gu:function(){return i},j_:function(){return r},vn:function(){return n}});var l,s,i,r,o=a(66641);(l=i||(i={})).Idle="idle",l.Loading="loading",l.Success="success",(s=r||(r={})).Idle="idle",s.Loading="loading",s.Compiling="compiling",s.SuccessLoaded="success_loaded",s.SuccessCompiled="success_compiled";let d={id:"",org_id:"",title:"New Playbook",body:"## Procedure\n\n1. **step 1**: explanation\n\n2. **step 2**: explanation\n\n## Advice & Pointers\n\nHelpful facts here\n\n## Forbidden actions\n\nAnything you don't want Devin to do",status:"published",access:"team",examples:[],compiled:{status:"idle",value:void 0},compilation_presigned_url:void 0,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),created_by:{id:"",full_name:"You",image_url:void 0},updated_by:{id:"",full_name:"You",image_url:void 0}},n=(0,o.Ue)((e,t)=>({playbookDraft:{...d},updatePlaybookDraft:t=>e(e=>({playbookDraft:{...e.playbookDraft,...t}})),resetPlaybookDraft:()=>e(e=>({playbookDraft:{...d,created_by:e.playbookDraft.created_by}})),playbookPreviewId:null,setPlaybookPreviewId:t=>e({playbookPreviewId:t}),playbookSelected:null,setPlaybookSelected:t=>e({playbookSelected:t}),playbooksListState:"idle",setPlaybooksListState:t=>e({playbooksListState:t}),playbooksList:[],setPlaybooksList:t=>e({playbooksList:t}),getPlaybookById:e=>t().playbooksList.find(t=>t.id===e),createPlaybook:t=>e(e=>({playbooksList:[...e.playbooksList,t]})),deletePlaybookById:t=>e(e=>({playbooksList:e.playbooksList.filter(e=>e.id!==t)})),updatePlaybookById:(t,a)=>e(e=>({playbooksList:e.playbooksList.map(e=>e.id===t?a:e)})),favoritesList:[],setFavoritesList:t=>e({favoritesList:t}),resetStore:()=>e({playbookDraft:d,playbooksListState:"idle",playbooksList:[],playbookPreviewId:null,playbookSelected:null,favoritesList:[]})}))},59730:function(e,t,a){a.d(t,{I:function(){return i},c:function(){return s}});let l="playbook-",s=e=>"".concat(l).concat(e),i=e=>e.substring(l.length)},24449:function(e,t,a){a.d(t,{I4:function(){return n},aM:function(){return d},cZ:function(){return u},jk:function(){return m}});var l=a(2560),s=a(26821),i=a(73822),r=a(4652),o=a(48536);function d(){let{orgId:e}=(0,r.aC)();return(0,l.a)({queryKey:["playbooks",e],queryFn:o.Cm,enabled:!!e})}function n(e){let{orgId:t}=(0,r.aC)();return(0,l.a)({queryKey:["playbooks",t,e],queryFn:()=>{if(e)return(0,o.Y8)(e)},enabled:!!e&&!!t})}let c=e=>{var t;return null!==(t=e.playbooks_favorites)&&void 0!==t?t:[]};function u(){let{userId:e,orgId:t}=(0,r.aC)();return(0,l.a)({queryKey:["org_metadata",t,e],queryFn:o.BG,select:c})}function m(){let{orgId:e,userId:t}=(0,r.aC)(),a=(0,s.NL)(),l=["org_metadata",e,t];return(0,i.D)({mutationFn:o.yX,async onMutate(e){await a.cancelQueries({queryKey:l});let t=a.getQueryData(l);return a.setQueryData(l,t=>({...t,playbooks_favorites:e.playbooks_favorites})),{prevMetadata:t}},onError(e,t,s){s&&a.setQueryData(l,s.prevMetadata)},onSettled(){a.invalidateQueries({queryKey:l})}})}},12122:function(e,t,a){a.d(t,{F:function(){return i},_:function(){return s}});var l=a(66641);let s={ami_id:"baseline",snapshot_id:"baseline",description:"Using base state",snapshot_name:"Base snapshot",status:"available",user_id:"",devin_id:"",startup_commands:[],deleted:!1},i=(0,l.Ue)(e=>({selectedPlaybook:null,selectedSnapshot:s,currentTab:null,setCurrentTab:t=>e({currentTab:t}),selectedConfigId:null,setSelectedSnapshot:t=>e({selectedSnapshot:t,selectedConfigId:null}),removeSelectedSnapshot:()=>e({selectedSnapshot:s,selectedConfigId:null}),setSelectedConfig:t=>e({selectedConfigId:t.configId,selectedPlaybook:t.playbook,selectedSnapshot:t.snapshot}),removeSelectedConfig:()=>e({selectedConfigId:null,selectedPlaybook:null,selectedSnapshot:s}),setSelectedPlaybook:t=>e({selectedPlaybook:t,selectedConfigId:null}),removeSelectedPlaybook:()=>e({selectedPlaybook:null,selectedConfigId:null}),selectedMultiDevin:null,setSelectedMultiDevin:t=>e({selectedMultiDevin:t}),selectedMultiDevinTasks:[],setSelectedMultiDevinTasks:t=>e({selectedMultiDevinTasks:t}),removeSelectedMultiDevin:()=>e({selectedMultiDevin:null}),confirmationCriteria:[],setConfirmationCriteria:t=>e({confirmationCriteria:t})}))},58022:function(e,t,a){a.d(t,{P7:function(){return c},eV:function(){return x},i2:function(){return m}});var l=a(31233),s=a.n(l),i=a(18255),r=a.n(i),o=a(29484);let d=s()(fetch),n=async(e,t)=>u(e.url)?{value:(await p(e)).src,type:"url"}:{value:await b(e,t),type:"text"},c=[".jpg",".jpeg",".gif",".png"],u=e=>{let t=new URL(e).pathname;return c.some(e=>t.endsWith(e))},m=r().memoize(n),p=async e=>{let t=e.url;if(!r().isEmpty(e.headers)){let a=await (await fetch(e.url,{headers:e.headers})).blob();t=URL.createObjectURL(a)}return new Promise((e,a)=>{let l=new Image;l.src=t,l.onload=()=>{e(l)},l.onerror=()=>{a(Error("Failed to load image"))}})},x=async(e,t,a)=>{let l=await o.L.post("presigned-url/batch/".concat(e),{json:{s3_key_list:t},...a}).json();return r().zipWith(l.urls_list,l.headers_list,(e,t)=>({url:e,headers:t}))},b=(e,t)=>d(e.url,{headers:e.headers,...t,retryOn:[404],retries:(null==t?void 0:t.shouldRetry)?5:0,retryDelay:e=>1e3*Math.pow(2,e)}).then(e=>e.text())}}]);